{"ast":null,"code":"import { mapMutations } from 'vuex';\nexport default {\n  data() {\n    return {\n      ruleForm: {\n        name: '',\n        store: '',\n        selling: false,\n        price: '',\n        desc: ''\n      },\n      rules: {\n        // 商品编号应大于 0 且为整数\n        name: [{\n          required: true,\n          message: '请输入商品编号',\n          trigger: 'blur'\n        }, {\n          type: 'integer',\n          min: 0,\n          message: '商品编号应大于 0 且为整数 ',\n          trigger: 'blur'\n        }],\n        // 存货量在 0 到 999999 之间且为整数\n        store: [{\n          required: true,\n          message: '请输入商品存货量',\n          trigger: 'blur'\n        }, {\n          type: 'integer',\n          min: 0,\n          max: 999999,\n          message: '存货量在 0 到 999999 之间且为整数',\n          trigger: 'blur'\n        }],\n        // 价格在 0 到 999999 之间\n        price: [{\n          required: true,\n          message: '请输入商品价格',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          min: 0,\n          max: 999999,\n          message: '价格在 0 到 999999 之间',\n          trigger: 'blur'\n        }],\n        // 长度在 3 到 40 个字符\n        desc: [{\n          required: true,\n          message: '请填写商品描述',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 40,\n          message: '长度在 3 到 40 个字符',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  methods: {\n    ...mapMutations(['setgoods']),\n    submitAdd(formName) {\n      // 将填写的所有信息根据上述规则进行严格校验\n      this.$refs[formName].validate(async valid => {\n        // 校验通过\n        if (valid) {\n          const file = document.querySelector('.el-upload__input').files[0];\n          // 单独校验图片\n          if (!file) {\n            alert('未上传商品图片');\n            return false;\n          }\n          // 整理所有表单信息\n          const fd = new FormData();\n          fd.append('goodsname', this.ruleForm.name);\n          fd.append('description', this.ruleForm.desc);\n          fd.append('price', this.ruleForm.price);\n          fd.append('store_num', this.ruleForm.store);\n          fd.append('sold_num', 0);\n          fd.append('selling', this.ruleForm.selling ? 1 : 0);\n          fd.append('file', file);\n          // 发送post请求\n          const {\n            data\n          } = await this.$http({\n            method: 'POST',\n            url: '/insert',\n            headers: {\n              Authorization: localStorage.getItem('token')\n            },\n            data: fd,\n            processData: false,\n            contentType: false\n          });\n          // 展示结果\n          alert(data.msg);\n          if (data.status === 200) {\n            this.resetForm('ruleForm');\n            const {\n              data\n            } = await this.$http({\n              method: 'get',\n              headers: {\n                Authorization: localStorage.getItem('token')\n              },\n              url: '/getfullgoods'\n            });\n            if (data.status === 200) {\n              this.setgoods(data.goods);\n            }\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\n    }\n  }\n};","map":{"version":3,"mappings":"AAqCA;AACA;EACAA;IACA;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;QACA;QACAL,OACA;UAAAM;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,EACA;QACA;QACAP,QACA;UAAAK;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAC;UAAAJ;UAAAC;QAAA,EACA;QACA;QACAL,QACA;UAAAG;UAAAC;UAAAC;QAAA,GACA;UAAAC;UAAAC;UAAAC;UAAAJ;UAAAC;QAAA,EACA;QACA;QACAJ,OACA;UAAAE;UAAAC;UAAAC;QAAA,GACA;UAAAE;UAAAC;UAAAJ;UAAAC;QAAA;MAEA;IACA;EACA;EACAI;IACA;IACAC;MACA;MACA;QACA;QACA;UACA;UACA;UACA;YACAC;YACA;UACA;UACA;UACA;UACAC;UACAA;UACAA;UACAA;UACAA;UACAA;UACAA;UACA;UACA;YAAAjB;UAAA;YACAkB;YACAC;YACAC;cACAC;YACA;YACArB;YACAsB;YACAC;UACA;UACA;UACAP;UACA;YACA;YACA;cAAAhB;YAAA;cACAkB;cACAE;gBACAC;cACA;cACAF;YACA;YACA;cACA;YACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAK;MACA;IACA;IACAC;MACA;IACA;EACA;AACA","names":["data","ruleForm","name","store","selling","price","desc","rules","required","message","trigger","type","min","max","methods","submitAdd","alert","fd","method","url","headers","Authorization","processData","contentType","resetForm","handleExceed"],"sourceRoot":"src/components","sources":["AddGoods.vue"],"sourcesContent":["<template>\n  <div class=\"add\">\n    <el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ruleForm\" label-width=\"100px\" class=\"demo-ruleForm\">\n      <el-form-item label=\"商品编号\" prop=\"name\" label-width=\"100px\">\n        <el-input v-model.number=\"ruleForm.name\" style=\"width: 50%\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"商品描述\" prop=\"desc\">\n        <el-input type=\"textarea\" style=\"width: 70%\" v-model=\"ruleForm.desc\"></el-input>\n      </el-form-item>\n      <!-- 商品图片只能上传png文件,且不超过500kb -->\n      <el-form-item label=\"商品图片\" prop=\"pic\">\n        <el-upload class=\"upload-demo\" ref=\"upload\" action=\"http://127.0.0.1/api\" :auto-upload=\"false\" accept=\".png\"\n          :limit=\"1\" :on-exceed=\"handleExceed\">\n          <el-button slot=\"trigger\" size=\"small\" type=\"primary\">选取文件</el-button>\n          <div slot=\"tip\" class=\"el-upload__tip\">只能上传png文件,且不超过500kb,推荐图片宽高比为1:1</div>\n        </el-upload>\n      </el-form-item>\n      <el-form-item label=\"商品价格\" prop=\"price\">\n        ¥&nbsp;&nbsp;<el-input v-model.number=\"ruleForm.price\" style=\"width: 100px\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"商品存货量\" prop=\"store\">\n        <el-input v-model.number=\"ruleForm.store\" style=\"width: 100px\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"是否在售\" prop=\"selling\">\n        <el-switch v-model=\"ruleForm.selling\"></el-switch>\n      </el-form-item>\n      <el-form-item>\n        <slot>\n          <el-button type=\"primary\" @click=\"submitAdd('ruleForm')\">新增商品</el-button>\n        </slot>\n        <el-button @click=\"resetForm('ruleForm')\" style=\"margin-left: 100px;\">重置</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { mapMutations } from 'vuex'\nexport default {\n  data() {\n    return {\n      ruleForm: {\n        name: '',\n        store: '',\n        selling: false,\n        price: '',\n        desc: ''\n      },\n      rules: {\n        // 商品编号应大于 0 且为整数\n        name: [\n          { required: true, message: '请输入商品编号', trigger: 'blur' },\n          { type: 'integer', min: 0, message: '商品编号应大于 0 且为整数 ', trigger: 'blur' }\n        ],\n        // 存货量在 0 到 999999 之间且为整数\n        store: [\n          { required: true, message: '请输入商品存货量', trigger: 'blur' },\n          { type: 'integer', min: 0, max: 999999, message: '存货量在 0 到 999999 之间且为整数', trigger: 'blur' }\n        ],\n        // 价格在 0 到 999999 之间\n        price: [\n          { required: true, message: '请输入商品价格', trigger: 'blur' },\n          { type: 'number', min: 0, max: 999999, message: '价格在 0 到 999999 之间', trigger: 'blur' }\n        ],\n        // 长度在 3 到 40 个字符\n        desc: [\n          { required: true, message: '请填写商品描述', trigger: 'blur' },\n          { min: 3, max: 40, message: '长度在 3 到 40 个字符', trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  methods: {\n    ...mapMutations(['setgoods']),\n    submitAdd(formName) {\n      // 将填写的所有信息根据上述规则进行严格校验\n      this.$refs[formName].validate(async (valid) => {\n        // 校验通过\n        if (valid) {\n          const file = document.querySelector('.el-upload__input').files[0]\n          // 单独校验图片\n          if (!file) {\n            alert('未上传商品图片')\n            return false\n          }\n          // 整理所有表单信息\n          const fd = new FormData()\n          fd.append('goodsname', this.ruleForm.name)\n          fd.append('description', this.ruleForm.desc)\n          fd.append('price', this.ruleForm.price)\n          fd.append('store_num', this.ruleForm.store)\n          fd.append('sold_num', 0)\n          fd.append('selling', this.ruleForm.selling ? 1 : 0)\n          fd.append('file', file)\n          // 发送post请求\n          const { data } = await this.$http({\n            method: 'POST',\n            url: '/insert',\n            headers: {\n              Authorization: localStorage.getItem('token')\n            },\n            data: fd,\n            processData: false,\n            contentType: false\n          })\n          // 展示结果\n          alert(data.msg)\n          if (data.status === 200) {\n            this.resetForm('ruleForm')\n            const { data } = await this.$http({\n              method: 'get',\n              headers: {\n                Authorization: localStorage.getItem('token')\n              },\n              url: '/getfullgoods'\n            })\n            if (data.status === 200) {\n              this.setgoods(data.goods)\n            }\n          }\n        } else {\n          return false\n        }\n      })\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`)\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.add {\n  margin: 0 5%;\n  padding-top: 20px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}